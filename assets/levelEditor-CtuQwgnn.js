import{s as M,M as S,B as L,S as B,H as I,W as K,a as O,I as T,b as U,c as V,P as C,d as N,e as W,G as D,T as J,p as H}from"./transitionManager-Bh8ykMtO.js";import"./p5-CLnVVuBm.js";class q{pos;scale;initialPos;offset;constructor(){this.pos=createVector(width/2,height/2),this.offset=null,this.initialPos=null,this.scale=1}draw(){translate(width/2,height/2),scale(this.scale),translate(-this.pos.x,-this.pos.y),this.offset?window.mousePos=p5.Vector.sub(this.offset,createVector(mouseX,mouseY)).div(this.scale):window.mousePos=createVector(mouseX,mouseY).sub(createVector(width/2,height/2)).div(this.scale).add(this.pos),this.offset&&(this.pos=window.mousePos.add(this.initialPos))}drawGrid(){push(),strokeWeight(1);for(let t=d(this.pos.x-width/2/this.scale);t<=d(this.pos.x+width/2/this.scale);t+=25)stroke(255,t%50==0?125:50),line(t,this.pos.y-height/2/this.scale,t,this.pos.y+height/2/this.scale);for(let t=d(this.pos.y-height/2/this.scale);t<=d(this.pos.y+height/2/this.scale);t+=25)stroke(255,t%50==0?125:50),line(this.pos.x-width/2/this.scale,t,this.pos.x+width/2/this.scale,t);pop()}beginMove(){this.initialPos=this.pos.copy(),this.offset=createVector(mouseX,mouseY)}endMove(){this.initialPos=null,this.offset=null}changeScale(t){t>0?this.scale*=.9:this.scale*=1.1}}function d(o){return round(o/50)*50}class r{pos;parent;r;dragStart;startPos;constructor(t,e){this.pos=createVector(t,e),this.checkSnapping(),this.r=4,this.dragStart=null,this.startPos=null}draw(){push(),this.mouseOver()?(strokeWeight(1),stroke(0),fill(0,138,124)):fill(0,186,168),circle(this.pos.x,this.pos.y,this.r*2),pop()}startDrag(){this.dragStart=window.mousePos,this.startPos=this.pos.copy()}drag(){const t=p5.Vector.sub(window.mousePos,this.dragStart),e=this.pos.copy(),s=p5.Vector.add(this.startPos,t);this.pos=s,this.checkSnapping(),this.parent.update(this,p5.Vector.sub(this.pos,e))}endDrag(){this.dragStart=null,this.startPos=null}mouseOver(){return this.pos.dist(window.mousePos)<this.r*2}checkSnapping(){keyIsPressed&&(key=="Shift"&&(this.pos=this.snap(this.pos)),key=="Control"&&(this.pos=this.snap(this.pos,25)))}snap(t,e=50){return createVector(round(t.x/e)*e,round(t.y/e)*e)}}class j{editor;vknots;constructor(t,e=[]){this.editor=t,this.vknots=[];for(const[s,n]of e)this.vknots.push(new r(s,n));t.registerKnots(this,...this.vknots)}addPoint(t,e){const s=new r(t,e),n=this.vknots;if(n.length<2)n.push(s);else{let i=1/0,l=0;const k=s.pos;for(let c=0;c<n.length;c++){const h=n[c].pos,m=n[(c+1)%n.length].pos,E=p5.Vector.sub(k,h),w=p5.Vector.sub(m,h),g=w.setMag(E.dot(w)/w.mag()).add(h),P=g.dist(k);g.dist(h)+g.dist(m)>=h.dist(m)+5||P<i&&(l=c+1,i=P)}n.splice(l,0,s)}this.editor.registerKnots(this,s),this.updatePolygon(!0)}removePoint(){for(let t=this.vknots.length-1;t>=0;t--){const e=this.vknots[t];if(e.mouseOver()){this.vknots.splice(t,1),this.editor.deregisterKnot(e),this.updatePolygon(!0);break}}}convertKnots(){return this.vknots.map(t=>[t.pos.x,t.pos.y])}}class R extends j{constructor(t){super(t,[[0,0],[width,0],[width,height],[0,height]])}draw(){push(),fill(94,230,83),strokeWeight(3),stroke(0,.25*255),beginShape();for(const t of this.vknots)vertex(t.pos.x+1.5,t.pos.y+1.5);endShape(CLOSE),pop(),push(),noFill(),strokeWeight(3),stroke(255),beginShape();for(const t of this.vknots)vertex(t.pos.x,t.pos.y);endShape(CLOSE),pop();for(const t of this.vknots)t.draw()}update(){}updatePolygon(){}toJSON(){return this.convertKnots()}}const u=Object.fromEntries(Object.entries(M).map(([o,t])=>[t.name,o]));class x{obj;knot;constructor(t,e){this.obj=t,this.knot=new r(t.pos.x,t.pos.y),e.registerKnots(this,this.knot)}draw(){this.obj.draw(),this.knot.draw()}update(t){this.obj.pos=t.pos.copy()}toJSON(t=this.obj.constructor.name){const e=u[t],s=this.knot.pos;return[e,[s.x,s.y]]}}class _ extends x{constructor(t,e){super(t,e),this.obj=new G(t)}toJSON(){return super.toJSON(S.name)}}class G extends L{constructor(t){super(t.pos.x,t.pos.y,t.r)}draw(){super.draw()}}class p extends B{knots;ball;hole;staticUIs;currEditPolygon;camera;levelBounds;constructor(){super(),this.knots=[],this.levelBounds=new R(this),this.hole=new x(new I(width-100,height-100),this),this.ball=new _(new S(100,100),this),this.staticUIs=[],this.camera=new q,this.currEditPolygon=null}draw(){background(161,207,161),push(),this.camera.draw(),this.levelBounds.draw(),this.camera.drawGrid(),this.hole.draw(),this.ball.draw();for(const t of this.staticUIs)t.draw();pop(),this.currEditPolygon&&(fill(0),textAlign(CENTER),textSize(20),text(`Left click to add vertex, Right click to remove vertex
Esc to finish`,width/2,30))}registerKnots(t,...e){for(const s of e)s.parent=t,this.knots.push(s)}deregisterKnot(t){const e=this.knots.indexOf(t);this.knots.splice(e,1)}removeUI(t){const e=this.staticUIs.indexOf(t);for(const s of this.knots)s.parent==t&&this.deregisterKnot(s);this.staticUIs.splice(e,1)}mousePressed(){if(mouseButton==CENTER){this.camera.beginMove();return}if(mouseButton==LEFT)for(let e=this.knots.length-1;e>=0;e--){const s=this.knots[e];if(s.mouseOver()){s.startDrag();return}}if(!this.currEditPolygon)return;let t=this.currEditPolygon;mouseButton==LEFT?t.addPoint(window.mousePos.x,window.mousePos.y):mouseButton==RIGHT&&t.removePoint()}mouseDragged(){for(const t of this.knots)if(t.dragStart){t.drag();break}}mouseReleased(){for(const t of this.knots)t.endDrag();this.camera.endMove()}mouseWheel(t){this.camera.changeScale(t.deltaY)}keyPressed(){this.currEditPolygon&&key=="Escape"&&(this.currEditPolygon=null)}getLevelData(){return{ball:[this.ball.knot.pos.x,this.ball.knot.pos.y],hole:[this.hole.knot.pos.x,this.hole.knot.pos.y],bounds:this.levelBounds.toJSON(),obstacles:this.staticUIs.map(e=>e.toJSON()),par:0}}}class f extends j{obj;editor;vknots;centerKnot;constructor(t,e){super(e),this.obj=t,this.vknots=[],this.centerKnot=new r(0,0);for(const[s,n]of t.points)this.vknots.push(new r(s,n));this.calcCenter(),e.registerKnots(this,...this.vknots,this.centerKnot),this.editor=e}draw(){this.obj.draw();for(const t of this.vknots)t.draw();this.centerKnot.draw()}update(t,e){if(t==this.centerKnot)for(const s of this.vknots)s.pos.add(e);else this.calcCenter();this.updatePolygon(!1)}updatePolygon(t){if(t&&this.calcCenter(),this.obj instanceof K){const e=this.centerKnot.pos.x,s=this.centerKnot.pos.y;this.obj.cx=e,this.obj.cy=s;const n=[];for(const i of this.vknots)n.push([i.pos.x-e,i.pos.y-s]);this.obj.render=n}this.obj.points=this.convertKnots()}calcCenter(){let t=0,e=0;for(const s of this.vknots)t+=s.pos.x,e+=s.pos.y;t/=this.vknots.length,e/=this.vknots.length,this.centerKnot.pos=createVector(t,e)}toJSON(){const t=u[this.obj.constructor.name],e=this.convertKnots();return[t,[e]]}}class y{obj;posKnot;dimKnot;centerKnot;constructor(t,e){this.obj=t,this.posKnot=new r(this.obj.x,this.obj.y),this.dimKnot=new r(this.obj.x+this.obj.w,this.obj.y+this.obj.h),this.centerKnot=new r(this.obj.x+this.obj.w/2,this.obj.y+this.obj.h/2),e.registerKnots(this,this.posKnot,this.dimKnot,this.centerKnot)}draw(){this.obj.draw(),this.posKnot.draw(),this.dimKnot.draw(),this.centerKnot.draw()}update(t){if(t==this.posKnot)this.obj.x=this.posKnot.pos.x,this.obj.y=this.posKnot.pos.y;else if(t==this.centerKnot){this.obj.x=this.centerKnot.pos.x-this.obj.w/2,this.obj.y=this.centerKnot.pos.y-this.obj.h/2,this.posKnot.pos=createVector(this.obj.x,this.obj.y),this.dimKnot.pos=createVector(this.obj.x+this.obj.w,this.obj.y+this.obj.h);return}const e=p5.Vector.sub(this.dimKnot.pos,this.posKnot.pos);this.obj.w=e.x,this.obj.h=e.y,this.centerKnot.pos=createVector(this.obj.x+this.obj.w/2,this.obj.y+this.obj.h/2)}toJSON(){const t=u[this.obj.constructor.name],e=this.posKnot.pos,s=this.dimKnot.pos.x-e.x,n=this.dimKnot.pos.y-e.y;return[t,[e.x,e.y,s,n]]}}class ${obj;startKnot;endKnot;constructor(t,e){this.obj=t,this.startKnot=new r(t.start.x,t.start.y),this.endKnot=new r(t.end.x,t.end.y),e.registerKnots(this,this.endKnot,this.startKnot)}draw(){this.obj.draw(),this.endKnot.draw(),this.startKnot.draw()}update(t){t==this.startKnot&&(this.obj.start=t.pos.copy()),t==this.endKnot&&(this.obj.end=t.pos.copy())}toJSON(){const t=u[this.obj.constructor.name],e=this.startKnot.pos,s=this.endKnot.pos;return[t,[s.x,s.y,e.x,e.y]]}}const Y=[{name:"Square Wall",createUI:(o,t,e)=>new y(new O(o,t,30,30),e)},{name:"Ice",createUI:(o,t,e)=>new y(new T(o,t,30,30),e)},{name:"Bouncer",createUI:(o,t,e)=>new x(new U(o,t),e)},{name:"Slope",createUI:(o,t,e)=>new y(new V(o,t,30,30,[1,0]),e),createHTML:F},{name:"Polygon Wall",createUI:(o,t,e)=>{const s=new f(new C([]),e);return e.currEditPolygon=s,s},createHTML:b},{name:"Water",createUI:(o,t,e)=>{const s=new f(new K([]),e);return e.currEditPolygon=s,s},createHTML:b},{name:"Sand",createUI:(o,t,e)=>{const s=new f(new N([]),e);return e.currEditPolygon=s,s},createHTML:b},{name:"Teleporter",createUI:(o,t,e)=>new $(new W(o,t,o,t),e)}];function v(o,t,e){const s=document.createElement("div"),n=document.createElement("input");n.value=t;const i=document.createElement("button");return i.innerHTML="&times;",i.addEventListener("click",()=>{e.removeUI(o),s.remove()}),s.append(n,i),s}function F(o,t,e){const s=v(o,t,e),n=document.createElement("button");return n.textContent="rotate",n.addEventListener("click",()=>{o.obj.force.rotate(PI/2)}),s.append(n),s}function b(o,t,e){const s=v(o,t,e),n=document.createElement("button");return n.textContent="edit",n.addEventListener("click",()=>{e.currEditPolygon=o}),s.append(n),s}class X{editorManager;objPalette;objList;playBtn;editBoundsBtn;exportBtn;exportTextarea;copyExportBtn;constructor(t){this.editorManager=t,this.objPalette=document.querySelector(".object-palette"),this.objList=document.querySelector(".objects-list"),this.playBtn=document.querySelector(".play-btn"),this.editBoundsBtn=document.querySelector(".edit-bound-btn"),this.exportBtn=document.querySelector(".export-btn"),this.exportTextarea=document.querySelector(".export-text"),this.copyExportBtn=document.querySelector(".copy-export-btn")}init(){this.createObjPalette(),this.playBtn.addEventListener("click",()=>{this.editorManager.togglePlayMode()}),this.editBoundsBtn.addEventListener("click",()=>{const t=this.editorManager.scene;t instanceof p&&(t.currEditPolygon=t.levelBounds)}),this.exportBtn.addEventListener("click",()=>this.exportLevel()),this.copyExportBtn.addEventListener("click",async()=>await this.copyExport())}createObjPalette(){for(const t of Y){const e=document.createElement("button");e.textContent=t.name,e.addEventListener("click",()=>{const s=this.editorManager.scene;if(!(s instanceof p))return;const n=t.createUI(s.camera.pos.x,s.camera.pos.y,s);s.staticUIs.push(n);const l=(t.createHTML||v)(n,t.name,s);this.objList.append(l)}),this.objPalette.append(e)}}exportLevel(){const e=this.editorManager.editorScene.getLevelData();let s=`{
    "ball": ${this.formatJSON(e.ball)},
    "hole": ${this.formatJSON(e.hole)},
    "obstacles": ${this.formatJSON(e.obstacles)},
    "bounds": ${this.formatJSON(e.bounds)},
    "par": 0
},`;this.exportTextarea.value=s}formatJSON(t){return JSON.stringify(t).replace(/:/g,": ").replace(/,/g,", ")}async copyExport(){const t=this.exportTextarea.value;await navigator.clipboard.writeText(t),this.copyExportBtn.textContent="Copied!",setTimeout(()=>{this.copyExportBtn.textContent="Copy"},1e3)}}class z extends D{editorManager;constructor(t,e){super(null,0),this.loadLevel(t),this.editorManager=e}nextLevel(){this.editorManager.completedPlayMode()}}class A{scene;htmlManager;editorScene;transitionManager;constructor(){this.editorScene=new p,this.scene=this.editorScene,this.htmlManager=new X(this),this.htmlManager.init(),this.transitionManager=new J}draw(){this.scene.draw(),this.transitionManager.draw()}togglePlayMode(){if(this.scene instanceof p){const t=this.scene.getLevelData();this.scene=new z(t,this)}else this.scene=this.editorScene}completedPlayMode(){this.transitionManager.transition(()=>{this.scene=this.editorScene})}}window.p5=H;let a;window.setup=()=>{noStroke();const o=createCanvas(.8*windowWidth,windowHeight).parent(document.querySelector(".canvas-content"));o.mousePressed(Q),o.mouseReleased(Z),o.mouseWheel(tt);const t=o.elt;t.addEventListener("selectstart",e=>e.preventDefault()),t.addEventListener("contextmenu",e=>e.preventDefault()),t.addEventListener("wheel",e=>e.preventDefault()),t.addEventListener("mousedown",e=>{e.button==1&&e.preventDefault()}),a=new A};window.draw=()=>{a.draw()};function Q(){a.scene.mousePressed()}function Z(){a.scene.mouseReleased()}window.mouseDragged=()=>{a.scene.mouseDragged()};function tt(o){a.scene.mouseWheel(o)}window.keyPressed=()=>{a.scene.keyPressed()};window.onbeforeunload=()=>"Are you sure you want to leave?";
