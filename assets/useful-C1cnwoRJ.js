import{c as g,G as d,M as f,H as b,C as y,W as u,a as k,I as K,B as j,P as x,S as v,T as P,p as m}from"./gameManager-CLOQRepS.js";class M{constructor(t,s,o,n,i){this.x=t,this.y=s,this.w=o,this.h=n,this.force=i.mult(.35)}draw(){fill(255,255,255,125),rect(this.x,this.y,this.w,this.h),fill(255);let t=this.x+this.w/2,s=this.y+this.h/2;push(),translate(t,s),rotate(this.force.heading()),triangle(-5,-10,5,0,-5,10),pop()}isColliding(t){return g(t.pos.x,t.pos.y,t.r,this.x,this.y,this.w,this.h)}collide(t){t.applyForce(this.force)}}class a{constructor(t,s,o){this.pos=createVector(t,s),this.r=4,this.selected=!1,this.prevPos=createVector(t,s),this.parent=o}draw(){this.update(),push(),this.selected||this.pos.dist(mousePos)<this.r?(strokeWeight(1),stroke(0),fill(0,138,124)):fill(0,186,168),circle(this.pos.x,this.pos.y,this.r*2),pop()}update(){this.prevPos=this.pos.copy(),this.selected&&(this.pos=mousePos,this.parent.update(this,p5.Vector.sub(this.pos,this.prevPos)))}check(){return!mouseIsPressed&&this.selected&&(this.selected=!1),mouseIsPressed&&!this.selected&&this.pos.dist(mousePos)<this.r&&(this.selected=!0),this.selected}}class l{constructor(t,s=!0){this.obj=t,this.knot=new a(t.pos.x,t.pos.y,this),s&&main.staticKnots.push(this.knot)}draw(){this.obj.draw(),this.knot.draw()}update(){this.obj.pos=this.knot.pos}}class S extends d{constructor(){super(),this.hasSelected=!1,this.staticKnots=[]}init(){this.mainb=new l(new f(80,80),!1),this.hole=new l(new b(width-80,height-80),!1),this.balls.push(this.mainb),this.levelBounds=[[0,0],[width,0],[width,height],[0,height]]}playMode(){this.gameManager=new d,this.gameManager.playMode=!0,window.main=this.gameManager,this.gameManager.init(),this.gameManager.generateLevel=()=>{this.gameManager.transition.end(),window.main=this,this.gameManager=null,this.mainb.update()},this.gameManager.camera=new y(0,0,width,height),this.gameManager.mainb=this.mainb.obj,this.gameManager.hole=this.hole.obj,this.gameManager.balls=[this.mainb.obj],this.gameManager.levelBounds=this.levelBounds;const t=[];for(const s of this.staticObjs)t.push(s.obj);this.gameManager.staticObjs=t}draw(){background(123,255,123);for(const t of this.staticObjs)t.draw();this.hole.draw();for(const t of this.balls)t.draw();this.hasSelected||this.checkKnots()}checkKnots(){if(!this.selectedPolygon){for(let t=this.balls.length-1;t>=0;t--)if(this.balls[t].knot.check()){this.hasSelected=!0;return}if(this.hole.knot.check()){this.hasSelected=!0;return}for(let t=this.staticKnots.length-1;t>=0;t--)if(this.staticKnots[t].check()){this.hasSelected=!0;return}}}}function w(e,t){const s=document.createElement("div"),o=document.createElement("input");o.value=t;const n=document.createElement("button");return n.innerHTML="&times;",n.addEventListener("click",()=>{for(let i=0;i<main.staticObjs.length;i++){const h=main.staticObjs[i];if(e==h){main.staticObjs.splice(i,1);break}}s.remove()}),s.append(o,n),s}function E(e,t){const s=w(e,t),o=document.createElement("button");return o.textContent="rotate",o.addEventListener("click",()=>{e.obj.force.rotate(PI/2)}),s.append(o),s}class r{constructor(t){this.obj=t,this.knots=[],this.centerKnot=new a(0,0,this),main.staticKnots.push(this.centerKnot)}draw(){this.obj.draw();for(const t of this.knots)t.draw();this.centerKnot.draw()}convertKnots(){return this.knots.map(t=>[t.pos.x,t.pos.y])}update(t,s){if(t==this.centerKnot)for(const o of this.knots)o.pos.add(s);else{let o=0,n=0;for(const i of this.knots)o+=i.pos.x,n+=i.pos.y;o/=this.knots.length,n/=this.knots.length,this.centerKnot.pos=createVector(o,n)}if(this.obj instanceof u){const o=this.centerKnot.pos.x,n=this.centerKnot.pos.y;this.obj.cx=o,this.obj.cy=n;const i=[];for(const h of this.knots)i.push([h.pos.x-o,h.pos.y-n]);this.obj.render=i}this.obj.points=this.convertKnots()}addPoint(t,s){const o=new a(t,s,this);this.knots.push(o),main.staticKnots.push(o),this.update()}}class p extends a{constructor(t,s,o,n,i){super(t,s,o),this.originKnot=n,this.axis=i}originUpdate(t){this.pos.add(t)}update(){if(this.prevPos=this.pos.copy(),this.selected){const t=mousePos,s=p5.Vector.sub(t,this.originKnot.pos),o=p5.Vector.setMag(this.axis,s.dot(this.axis)/this.axis.mag()).add(this.originKnot.pos);this.pos=o,this.parent.update(this,p5.Vector.sub(this.pos,this.prevPos))}}}class c{constructor(t){this.obj=t,this.posKnot=new a(this.obj.x,this.obj.y,this),this.widthKnot=new p(this.obj.x+this.obj.w,this.obj.y,this,this.posKnot,createVector(1,0)),this.heightKnot=new p(this.obj.x,this.obj.y+this.obj.h,this,this.posKnot,createVector(0,1)),main.staticKnots.push(this.posKnot,this.widthKnot,this.heightKnot)}draw(){this.obj.draw(),this.posKnot.draw(),this.widthKnot.draw(),this.heightKnot.draw()}update(t,s){t==this.posKnot&&(this.widthKnot.originUpdate(s),this.heightKnot.originUpdate(s));const o=this.posKnot.pos;this.obj.x=o.x,this.obj.y=o.y,this.obj.w=this.widthKnot.pos.x-o.x,this.obj.h=this.heightKnot.pos.y-o.y}}class I{constructor(t){this.obj=t,this.startKnot=new a(t.start.x,t.start.y,this),this.endKnot=new a(t.end.x,t.end.y,this),main.staticKnots.push(this.startKnot,this.endKnot)}draw(){this.obj.draw(),this.startKnot.draw(),this.endKnot.draw()}update(){this.obj.start=this.startKnot.pos,this.obj.end=this.endKnot.pos}}const V=[{name:"Square Wall",create:(e,t)=>new c(new k(e,t,30,30))},{name:"Ice",create:(e,t)=>new c(new K(e,t,30,30))},{name:"Bouncer",create:(e,t)=>new l(new j(e,t))},{name:"Slope",create:(e,t)=>new c(new M(e,t,30,30,createVector(1,0))),render:E},{name:"Polygon Wall",create:()=>{const e=new r(new x([]));return main.selectedPolygon=e,e}},{name:"Water",create:()=>{const e=new r(new u([]));return main.selectedPolygon=e,e}},{name:"Sand",create:()=>{const e=new r(new v([]));return main.selectedPolygon=e,e}},{name:"Teleporter",create:(e,t)=>new I(new P(e,t,e,t))}],B=document.querySelector(".object-template"),C=document.querySelector(".objects-list");for(const e of V){const t=document.createElement("button");t.textContent=e.name,t.addEventListener("click",()=>{const s=e.create(width/2,height/2);main.staticObjs.push(s);const n=(e.render||w)(s,e.name);C.append(n)}),B.append(t)}window.p5=m;window.mousex=void 0;window.mousey=void 0;window.main=new S;window.setup=()=>{noStroke();const e=createCanvas(.8*windowWidth,windowHeight).parent(document.querySelector(".canvas-content"));e.mousePressed(L),e.mouseClicked(U),e.elt.addEventListener("selectstart",t=>t.preventDefault()),e.elt.addEventListener("contextmenu",t=>t.preventDefault()),main.init()};window.draw=()=>{window.mousePos=createVector(mouseX,mouseY),main.draw(),main.selectedPolygon&&(fill(0),textAlign(CENTER),textSize(20),text(`Left click to add vertex, Right click to remove vertex
Esc to finish`,width/2,30))};function L(){if(!main.selectedPolygon)return;let e=main.selectedPolygon;if(mouseButton==LEFT)e.addPoint(mouseX,mouseY);else if(mouseButton==RIGHT){for(let t=e.knots.length-1;t>=0;t--)if(e.knots[t].check()){e.knots.splice(t,1),e.update();break}}return!1}function U(){if(main.playMode){const e=m.Vector.sub(createVector(mousex,mousey),main.mainb.pos).div(32);main.mainb.vel=e}}window.keyPressed=()=>{main.selectedPolygon&&key=="Escape"&&(main.selectedPolygon=null)};window.mouseReleased=()=>{main.hasSelected=!1};document.querySelector(".play-btn").addEventListener("click",()=>{main.playMode()});
