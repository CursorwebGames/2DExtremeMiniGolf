import{c as k,a as K,b as C,B as W,H as E,S as j,M as O,G as R,T as U,C as q,p as B}from"./gameManager-CzuxhF2q.js";class ${constructor(t,e){this.pos=createVector(t,e),this.r=30,this.hit=0}draw(){fill("yellow"),this.hit>0&&this.hit--,circle(this.pos.x,this.pos.y,this.r*2+(this.hit?20:0))}isColliding(t){return k(t.pos,t.r,this.pos,this.r)}collide(t){let e=p5.Vector.sub(t.pos,this.pos);t.applyForce(e.setMag(16)),this.hit=10}}class P{constructor(t,e,i,o){this.x=t,this.y=e,this.w=i,this.h=o}draw(){fill(123,0,255),rect(this.x,this.y,this.w,this.h)}collide(t){let e=t.pos.x,i=t.pos.y;e<this.x&&(t.vel.x*=-1,t.pos.x=this.x-t.r),e>this.x+this.w&&(t.vel.x*=-1,t.pos.x=this.x+this.w+t.r),i<this.y&&(t.vel.y*=-1,t.pos.y=this.y-t.r),i>this.y+this.h&&(t.vel.y*=-1,t.pos.y=this.y+this.h+t.r)}isColliding(t){return K(t.pos.x,t.pos.y,t.r,this.x,this.y,this.w,this.h)}}class I extends P{constructor(t,e,i,o){super(t,e,i,o),this.disabled=!1,this.shatter=createVector(this.x,this.y),this.normal=createVector(0,0),this.mag=max(i,o)}draw(){if(!this.disabled)push(),strokeWeight(4),stroke(255,125),fill(123,0,255,125),rect(this.x+1,this.y+1,this.w-2,this.h-2),pop();else{push(),strokeWeight(4),stroke(255,125),fill(123,0,255,20),rect(this.x+1,this.y+1,this.w-2,this.h-2),beginClip(),rect(this.x+1,this.y+1,this.w-2,this.h-2),endClip(),strokeWeight(4),stroke(255,100);for(let t=0;t<PI/2;t+=.5){let e=p5.Vector.rotate(this.normal,t).mult(this.mag).add(this.shatter);line(this.shatter.x,this.shatter.y,e.x,e.y),t!=0&&(e=p5.Vector.rotate(this.normal,-t).mult(this.mag).add(this.shatter),line(this.shatter.x,this.shatter.y,e.x,e.y))}pop()}}collide(t){let e=t.pos.x,i=t.pos.y;e<this.x&&(this.shatter.y=t.pos.y,this.normal=createVector(1,0)),e>this.x+this.w&&(this.shatter.x=this.x+this.w,this.shatter.y=t.pos.y,this.normal=createVector(-1,0)),i<this.y&&(this.shatter.x=t.pos.x,this.normal=createVector(0,1)),i>this.y+this.h&&(this.shatter.y=this.y+this.h,this.shatter.x=t.pos.x,this.normal=createVector(0,-1)),super.collide(t),this.disabled=!0}isColliding(t){return!this.disabled&&super.isColliding(t)}}class M{constructor(t){this.points=t}draw(){fill(123,0,255),beginShape();for(const[t,e]of this.points)vertex(t,e);endShape()}collide(t,{projPoint:e,edge:i}){let o=p5.Vector.sub(t.pos,e),n=t.vel.mag(),r=Math.abs(t.vel.angleBetween(i));t.pos.add(p5.Vector.setMag(o,t.r-o.mag())),t.applyForce(o.setMag(2*Math.sin(r)*n))}isColliding(t){return C(t.pos,t.r,this.points)}}class T{constructor(t,e,i,o,n){this.x=t,this.y=e,this.w=i,this.h=o,this.force=n.mult(.35)}draw(){fill(255,255,255,125),rect(this.x,this.y,this.w,this.h),fill(255);let t=this.x+this.w/2,e=this.y+this.h/2;push(),translate(t,e),rotate(this.force.heading()),triangle(-5,-10,5,0,-5,10),pop()}isColliding(t){return K(t.pos.x,t.pos.y,t.r,this.x,this.y,this.w,this.h)}collide(t){t.applyForce(this.force)}}class L{constructor(t,e,i,o){this.start=createVector(t,e),this.end=createVector(i,o),this.r=14,this.hasTeleported=!1}draw(){push(),noFill(),strokeWeight(4),stroke(123,123,255),circle(this.start.x,this.start.y,this.r*2),stroke(255,179,3),circle(this.end.x,this.end.y,this.r*2),pop()}collide(t,e){let i,o;e==-1?i=this.start.copy():i=this.end.copy(),this.hasTeleported==-1?o=this.start.copy():o=this.end.copy(),!(t.pos.dist(o)<=this.r+t.r)&&(t.pos=i)}isColliding(t){if(k(t.pos,t.r,this.start,this.r))return this.hasTeleported||(this.hasTeleported=1),1;if(k(t.pos,t.r,this.end,this.r))return this.hasTeleported||(this.hasTeleported=-1),-1;this.hasTeleported=!1}}class S{constructor(t){this.points=t;let e=0,i=0;for(const[o,n]of t)e+=o,i+=n;e/=t.length,i/=t.length,this.render=[];for(const[o,n]of t)this.render.push([o-e,n-i]);this.cx=e,this.cy=i,this.startColor=color(61,137,255),this.toColor=color(0,73,186)}draw(){fill(40,150,255),push(),translate(this.cx,this.cy),scale(1);for(let t=-1;t<4;t++){let e;t==-1?e=color(255,247,128):e=lerpColor(this.startColor,this.toColor,t/4),fill(e),beginShape();for(const[i,o]of this.render)vertex(i,o);endShape(),scale(.9)}pop()}collide(t){t.pos=t.prevPos.copy(),t.vel.setMag(0)}isColliding(t){return C(t.pos,t.r,this.points)}}class a{constructor(t,e,i){this.pos=createVector(t,e),this.r=4,this.selected=!1,this.prevPos=createVector(t,e),this.parent=i}draw(){this.update(),push(),this.selected||this.pos.dist(mousePos)<this.r*2?(strokeWeight(1),stroke(0),fill(0,138,124)):fill(0,186,168),circle(this.pos.x,this.pos.y,this.r*2),pop()}update(){this.prevPos=this.pos.copy(),this.selected&&(this.pos=mousePos,this.parent.update(this,p5.Vector.sub(this.pos,this.prevPos)))}check(){return!mouseIsPressed&&this.selected&&(this.selected=!1),mouseIsPressed&&mouseButton!=CENTER&&!this.selected&&this.pos.dist(mousePos)<this.r*2&&(this.selected=!0),this.selected}}const y={[W]:"Ball",[$]:"Bouncer",[E]:"Hole",[I]:"Ice",[M]:"PolygonWall",[j]:"Sand",[T]:"Slope",[L]:"Teleporter",[P]:"Wall",[S]:"Water"};class v{constructor(t,e=!0){this.obj=t,this.knot=new a(t.pos.x,t.pos.y,this),e&&main.staticKnots.push(this.knot)}draw(){this.obj.draw(),this.knot.draw()}update(){this.obj.pos=this.knot.pos.copy()}export(){return`new ${y[this.obj.constructor]}(${this.obj.pos.x}, ${this.obj.pos.y})`}}class H{constructor(){this.pos=createVector(width/2,height/2),this.scale=.8}draw(){const t=width/2-this.pos.x,e=height/2-this.pos.y;translate(t,e),scale(this.scale),this.offset?window.mousePos=p5.Vector.sub(this.offset,createVector(mouseX,mouseY)):window.mousePos=createVector(mouseX,mouseY).sub(createVector(t,e)).div(this.scale),this.offset&&(this.pos=mousePos.add(this.initialPos))}beginMove(){this.initialPos=this.pos.copy(),this.offset=createVector(mouseX,mouseY)}endMove(){this.initialPos=null,this.offset=null}changeScale(t){t>0?this.scale*=.9:this.scale*=1.1}}class D{constructor(){this.knots=[new a(0,0,this),new a(width,0,this),new a(width,height,this),new a(0,height,this)],main.staticKnots.push(...this.knots)}draw(){push(),noFill(),strokeWeight(1),stroke(255),beginShape();for(const t of this.knots)vertex(t.pos.x,t.pos.y);endShape(CLOSE),pop();for(const t of this.knots)t.draw()}update(){}convertKnots(){return this.knots.map(t=>[t.pos.x,t.pos.y])}addPoint(t,e){const i=new a(t,e,this),o=this.knots;if(o.length<2)o.push(i);else{let n=1/0,r=0;const l=i.pos;for(let h=0;h<o.length;h++){const c=o[h].pos,d=o[(h+1)%o.length].pos,x=p5.Vector.sub(l,c),p=p5.Vector.sub(d,c),u=p.setMag(x.dot(p)/p.mag()).add(c),m=u.dist(l);u.dist(c)+u.dist(d)>=c.dist(d)+5||m<n&&(r=h+1,n=m)}o.splice(r,0,i)}main.staticKnots.push(i),this.update()}export(){return JSON.stringify(this.convertKnots())}}class F{constructor(){this.balls=[],this.staticObjs=[],this.hasSelected=!1,this.staticKnots=[]}init(){this.mainb=new v(new O(80,80),!1),this.hole=new v(new E(width-80,height-80),!1),this.balls.push(this.mainb),this.levelBounds=new D,this.camera=new H}playMode(){const t=new f(this);window.main=t,t.init(),t.generateLevel()}draw(){this.camera.draw(),background(123,255,123),this.levelBounds.draw();for(const t of this.staticObjs)t.draw();this.hole.draw();for(const t of this.balls)t.draw();this.hasSelected||this.checkKnots()}checkKnots(){if(!this.selectedPolygon){for(let t=this.balls.length-1;t>=0;t--)if(this.balls[t].knot.check()){this.hasSelected=!0;return}if(this.hole.knot.check()){this.hasSelected=!0;return}for(let t=this.staticKnots.length-1;t>=0;t--)if(this.staticKnots[t].check()){this.hasSelected=!0;return}}}}class f extends R{constructor(t){super(),this.editor=t}init(){this.transition=new U(this.reset.bind(this))}reset(){window.main=this.editor;const t=this.editor.mainb.obj;t.vel.setMag(0),t.inHole=!0,this.editor.mainb.update()}generateLevel(){this.mainb=this.editor.mainb.obj,this.mainb.inHole=!1,this.balls.push(this.mainb),this.hole=this.editor.hole.obj,this.hole.ballIn=!1;for(const r of this.editor.staticObjs)this.staticObjs.push(r.obj);const t=this.editor.levelBounds.convertKnots();this.levelBounds=t;let e=t[0][0],i=t[0][1],o=t[0][0],n=t[0][1];for(let r=1;r<t.length;r++){let[l,h]=t[r];l<e&&(e=l),h<i&&(i=h),l>o&&(o=l),h>n&&(n=h)}this.camera=new q(e,i,o,n)}}function V(s,t){const e=document.createElement("div"),i=document.createElement("input");i.value=t;const o=document.createElement("button");return o.innerHTML="&times;",o.addEventListener("click",()=>{for(let n=0;n<main.staticObjs.length;n++){const r=main.staticObjs[n];if(s==r){main.staticObjs.splice(n,1);break}}e.remove()}),e.append(i,o),e}function N(s,t){const e=V(s,t),i=document.createElement("button");return i.textContent="rotate",i.addEventListener("click",()=>{s.obj.force.rotate(PI/2)}),e.append(i),e}function g(s,t){const e=V(s,t),i=document.createElement("button");return i.textContent="edit",i.addEventListener("click",()=>{window.main.selectedPolygon=s}),e.append(i),e}class w{constructor(t){this.obj=t,this.knots=[],this.centerKnot=new a(0,0,this),main.staticKnots.push(this.centerKnot)}draw(){this.obj.draw();for(const t of this.knots)t.draw();this.centerKnot.draw()}convertKnots(){return this.knots.map(t=>[t.pos.x,t.pos.y])}update(t,e){if(t==this.centerKnot)for(const i of this.knots)i.pos.add(e);else{let i=0,o=0;for(const n of this.knots)i+=n.pos.x,o+=n.pos.y;i/=this.knots.length,o/=this.knots.length,this.centerKnot.pos=createVector(i,o)}if(this.obj instanceof S){const i=this.centerKnot.pos.x,o=this.centerKnot.pos.y;this.obj.cx=i,this.obj.cy=o;const n=[];for(const r of this.knots)n.push([r.pos.x-i,r.pos.y-o]);this.obj.render=n}this.obj.points=this.convertKnots()}addPoint(t,e){const i=new a(t,e,this),o=this.knots;if(o.length<2)o.push(i);else{let n=1/0,r=0;const l=i.pos;for(let h=0;h<o.length;h++){const c=o[h].pos,d=o[(h+1)%o.length].pos,x=p5.Vector.sub(l,c),p=p5.Vector.sub(d,c),u=p.setMag(x.dot(p)/p.mag()).add(c),m=u.dist(l);u.dist(c)+u.dist(d)>=c.dist(d)+5||m<n&&(r=h+1,n=m)}o.splice(r,0,i)}main.staticKnots.push(i),this.update()}export(){return`new ${y[this.obj.constructor]}(${JSON.stringify(this.obj.points)})`}}class b extends w{constructor(t){super(t),this.knots=[new a(this.obj.x,this.obj.y,this),new a(this.obj.x+this.obj.w,this.obj.y+this.obj.h,this)],main.staticKnots.push(...this.knots),this.update()}update(t,e){super.update(t,e),this.obj.x=this.knots[0].pos.x,this.obj.y=this.knots[0].pos.y,this.obj.w=this.knots[1].pos.x-this.obj.x,this.obj.h=this.knots[1].pos.y-this.obj.y}export(){return`new ${y[this.obj.constructor]}(${this.obj.x}, ${this.obj.y}, ${this.obj.w}, ${this.obj.h})`}}class Y{constructor(t){this.obj=t,this.startKnot=new a(t.start.x,t.start.y,this),this.endKnot=new a(t.end.x,t.end.y,this),main.staticKnots.push(this.startKnot,this.endKnot)}draw(){this.obj.draw(),this.startKnot.draw(),this.endKnot.draw()}update(){this.obj.start=this.startKnot.pos,this.obj.end=this.endKnot.pos}export(){return`new ${y[this.obj.constructor]}(${this.obj.start.x}, ${this.obj.start.y}, ${this.obj.end.x}, ${this.obj.end.y})`}}const G=[{name:"Square Wall",create:(s,t)=>new b(new P(s,t,30,30))},{name:"Ice",create:(s,t)=>new b(new I(s,t,30,30))},{name:"Bouncer",create:(s,t)=>new v(new $(s,t))},{name:"Slope",create:(s,t)=>new b(new T(s,t,30,30,createVector(1,0))),render:N},{name:"Polygon Wall",create:()=>{const s=new w(new M([]));return main.selectedPolygon=s,s},render:g},{name:"Water",create:()=>{const s=new w(new S([]));return main.selectedPolygon=s,s},render:g},{name:"Sand",create:()=>{const s=new w(new j([]));return main.selectedPolygon=s,s},render:g},{name:"Teleporter",create:(s,t)=>new Y(new L(s,t,s,t))}],X=document.querySelector(".object-template"),J=document.querySelector(".objects-list");for(const s of G){const t=document.createElement("button");t.textContent=s.name,t.addEventListener("click",()=>{const e=s.create(main.camera.pos.x,main.camera.pos.y);main.staticObjs.push(e);const o=(s.render||V)(e,s.name);J.append(o)}),X.append(t)}window.p5=B;window.mousex=void 0;window.mousey=void 0;window.main=new F;window.setup=()=>{noStroke();const s=createCanvas(.8*windowWidth,windowHeight).parent(document.querySelector(".canvas-content"));s.mousePressed(z),s.mouseClicked(A),s.mouseWheel(Q),s.elt.addEventListener("selectstart",t=>t.preventDefault()),s.elt.addEventListener("contextmenu",t=>t.preventDefault()),s.elt.addEventListener("wheel",t=>t.preventDefault()),s.elt.addEventListener("mousedown",t=>{t.button==1&&t.preventDefault()}),main.init()};window.draw=()=>{push(),main.draw(),pop(),main.selectedPolygon&&(fill(0),textAlign(CENTER),textSize(20),text(`Left click to add vertex, Right click to remove vertex
Esc to finish`,width/2,30))};function z(){if(main instanceof f||(mouseButton==CENTER&&main.camera.beginMove(),!main.selectedPolygon))return;let s=main.selectedPolygon;if(mouseButton==LEFT)s.addPoint(mousePos.x,mousePos.y);else if(mouseButton==RIGHT){for(let t=s.knots.length-1;t>=0;t--)if(s.knots[t].check()){s.knots.splice(t,1),s.update();break}}}function A(){if(main instanceof f){const s=B.Vector.sub(createVector(mousex,mousey),main.mainb.pos).div(32);main.mainb.vel=s}}window.keyPressed=()=>{main.selectedPolygon&&key=="Escape"&&(main.selectedPolygon=null)};window.mouseReleased=()=>{main instanceof f||(main.hasSelected=!1,main.camera.endMove())};function Q(s){main.camera.changeScale(s.deltaY)}document.querySelector(".play-btn").addEventListener("click",()=>{main instanceof f?main.reset():main.playMode()});document.querySelector(".edit-bound-btn").addEventListener("click",()=>{main.selectedPolygon=main.levelBounds});document.querySelector(".export-btn").addEventListener("click",()=>{let s="";for(const e of main.staticObjs)s+=e.export()+",";let t=`{
        mainb: [${main.mainb.obj.pos.x}, ${main.mainb.obj.pos.y}],
        hole: [${main.hole.obj.pos.x}, ${main.hole.obj.pos.y}],
        static: [${s}],
        balls: [],
        bounds: ${main.levelBounds.export()},
    }`;document.querySelector(".export-text").value=t});
