import{p as R}from"./p5.min-h_YlYhQD.js";class g{constructor(t,e,s){this.pos=createVector(t,e),this.r=4,this.selected=!1,this.prevPos=createVector(t,e),this.parent=s}draw(){this.update(),push(),this.selected||this.pos.dist(mousePos)<this.r*2?(strokeWeight(1),stroke(0),fill(0,138,124)):fill(0,186,168),circle(this.pos.x,this.pos.y,this.r*2),pop()}update(){this.prevPos=this.pos.copy(),this.selected&&(this.pos=mousePos,this.parent.update(this,p5.Vector.sub(this.pos,this.prevPos)))}check(){return!mouseIsPressed&&this.selected&&(this.selected=!1),mouseIsPressed&&mouseButton!=CENTER&&!this.selected&&this.pos.dist(mousePos)<this.r*2&&(this.selected=!0),this.selected}toString(){return`${Math.round(this.pos.x)}, ${Math.round(this.pos.y)}`}}function j(i,t,e,s){return i.dist(e)<=t+s}function F(i,t,e,s,o,n,r){let a,l;i<s?a=s:i>s+n?a=s+n:a=i,t<o?l=o:t>o+r?l=o+r:l=t;const c=i-a,m=t-l;return Math.sqrt(c**2+m**2)<e}function z(i,t,e,s){const o=p5.Vector.sub(i,e),n=p5.Vector.sub(s,e),r=n.setMag(o.dot(n)/n.mag()).add(e);return r.dist(e)+r.dist(s)>e.dist(s)+t?!1:r.dist(i)<t?r:!1}function M(i,t,e){for(let s=0;s<e.length;s++){const o=(s+1)%e.length,n=createVector(...e[s]),r=createVector(...e[o]),a=z(i,t,n,r);if(a)return{projPoint:a,edge:p5.Vector.sub(r,n)}}return!1}function Y(i,t){let e=!1;const s=i.x,o=i.y;for(let n=0;n<t.length;n++){const r=(n+1)%t.length,a=createVector(...t[n]),l=createVector(...t[r]);(a.y>=o&&l.y<o||a.y<o&&l.y>=o)&&s<(l.x-a.x)*(o-a.y)/(l.y-a.y)+a.x&&(e=!e)}return e}const X=.016,C=10;class H{constructor(t,e,s){this.pos=createVector(t,e),this.vel=createVector(0,0),this.r=s,this.prevPos=this.pos.copy()}draw(){fill(100),circle(this.pos.x,this.pos.y,this.r*2)}applyForce(t){this.vel.add(t)}update(t=1){this.checkBounds(),this.pos.add(p5.Vector.div(this.vel,t)),this.vel.mult(1-X/t),this.vel.limit(C),this.vel.mag()>0&&this.vel.mag()<.03&&(this.prevPos=this.pos.copy(),this.vel.setMag(0))}checkBounds(){let{projPoint:t,edge:e}=M(this.pos,this.r,main.levelBounds);if(t){let s=p5.Vector.sub(this.pos,t),o=this.vel.mag(),n=Math.abs(this.vel.angleBetween(e));this.pos.add(p5.Vector.setMag(s,this.r-s.mag())),this.applyForce(s.setMag(2*Math.sin(n)*o))}}collide(t){let e=p5.Vector.sub(t.pos,this.pos);this.vel.mult(.8);let s=this.vel.mag();t.applyForce(e.setMag(s))}}class h{constructor(t,e){this.pos=createVector(t,e),this.r=30,this.hit=0}draw(){fill("yellow"),this.hit>0&&this.hit--,circle(this.pos.x,this.pos.y,this.r*2+(this.hit?20:0))}isColliding(t){return j(t.pos,t.r,this.pos,this.r)}collide(t){let e=p5.Vector.sub(t.pos,this.pos);t.applyForce(e.setMag(16)),this.hit=10}}class W{constructor(t,e){this.pos=createVector(t,e),this.ballIn=!1,this.r=12}draw(){fill(0),circle(this.pos.x,this.pos.y,this.r*2)}isColliding(t){return j(t.pos,t.r,this.pos,this.r)}collide(t,e){t.vel.mag()<.001&&!this.ballIn&&(e(),this.ballIn=!0,main.mainb.inHole=!0),t.vel.mult(.9);let s=p5.Vector.sub(this.pos,t.pos);t.applyForce(s.setMag(this.pos.dist(t.pos)*.1))}}class x{constructor(t,e,s,o){this.x=t,this.y=e,this.w=s,this.h=o}draw(){fill(217,238,255),rect(this.x,this.y,this.w,this.h)}collide(t){let e=t.pos.x,s=t.pos.y;e<this.x&&(t.vel.x*=-1,t.pos.x=this.x-t.r),e>this.x+this.w&&(t.vel.x*=-1,t.pos.x=this.x+this.w+t.r),s<this.y&&(t.vel.y*=-1,t.pos.y=this.y-t.r),s>this.y+this.h&&(t.vel.y*=-1,t.pos.y=this.y+this.h+t.r)}isColliding(t){return F(t.pos.x,t.pos.y,t.r,this.x,this.y,this.w,this.h)}}class d extends x{constructor(t,e,s,o){super(t,e,s,o),this.disabled=!1,this.shatter=createVector(this.x,this.y),this.normal=createVector(0,0),this.mag=max(s,o)}draw(){if(!this.disabled)push(),strokeWeight(4),stroke(255,125),fill(123,0,255,125),rect(this.x+1,this.y+1,this.w-2,this.h-2),pop();else{push(),strokeWeight(4),stroke(255,125),fill(123,0,255,20),rect(this.x+1,this.y+1,this.w-2,this.h-2),beginClip(),rect(this.x+1,this.y+1,this.w-2,this.h-2),endClip(),strokeWeight(4),stroke(255,100);for(let t=0;t<PI/2;t+=.5){let e=p5.Vector.rotate(this.normal,t).mult(this.mag).add(this.shatter);line(this.shatter.x,this.shatter.y,e.x,e.y),t!=0&&(e=p5.Vector.rotate(this.normal,-t).mult(this.mag).add(this.shatter),line(this.shatter.x,this.shatter.y,e.x,e.y))}pop()}}collide(t){let e=t.pos.x,s=t.pos.y;e<this.x&&(this.shatter.y=t.pos.y,this.normal=createVector(1,0)),e>this.x+this.w&&(this.shatter.x=this.x+this.w,this.shatter.y=t.pos.y,this.normal=createVector(-1,0)),s<this.y&&(this.shatter.x=t.pos.x,this.normal=createVector(0,1)),s>this.y+this.h&&(this.shatter.y=this.y+this.h,this.shatter.x=t.pos.x,this.normal=createVector(0,-1)),super.collide(t),this.disabled=!0}isColliding(t){return!this.disabled&&super.isColliding(t)}}class U extends H{constructor(t,e){super(t,e,10),this.inHole=!1,this.dragOrigin=!1}draw(){fill(255),circle(this.pos.x,this.pos.y,this.r*2),this.dragOrigin&&this.drag()}drag(){if(this.inHole||this.vel.mag()!=0)return;let t=this.getDir();main.camera.scale=lerp(main.camera.scale,C*30/(t.mag()+C*30),.1);for(let e=1;e<6;e++){const s=createVector().lerp(t,e/5);circle(s.x+this.pos.x,s.y+this.pos.y,5)}}getDir(){return p5.Vector.sub(this.dragOrigin,createVector(mouseX,mouseY)).mult(2).limit(C*30)}}class p{constructor(t){this.points=t}draw(){fill(217,238,255),beginShape();for(const[t,e]of this.points)vertex(t,e);endShape()}collide(t,{projPoint:e,edge:s}){let o=p5.Vector.sub(t.pos,e),n=t.vel.mag(),r=Math.abs(t.vel.angleBetween(s));t.pos.add(p5.Vector.setMag(o,t.r-o.mag())),t.applyForce(o.setMag(2*Math.sin(r)*n))}isColliding(t){return M(t.pos,t.r,this.points)}}const G=.05;class w{constructor(t){this.points=t}draw(){push(),strokeWeight(16),stroke(217,210,111),fill(255,247,128),beginShape();for(const[t,e]of this.points)vertex(t,e);endShape(CLOSE),pop()}collide(t){t.vel.mult(1-G)}isColliding(t){return M(t.pos,t.r,this.points)||Y(t.pos,this.points)}}class u{constructor(t,e,s,o,n){this.x=t,this.y=e,this.w=s,this.h=o,this.force=n.mult(.35)}draw(){fill(255,255,255,125),rect(this.x,this.y,this.w,this.h),fill(255);let t=this.x+this.w/2,e=this.y+this.h/2;push(),translate(t,e),rotate(this.force.heading()),triangle(-5,-10,5,0,-5,10),pop()}isColliding(t){return F(t.pos.x,t.pos.y,t.r,this.x,this.y,this.w,this.h)}collide(t){t.applyForce(this.force)}}class f{constructor(t,e,s,o){this.start=createVector(t,e),this.end=createVector(s,o),this.r=14,this.hasTeleported=!1}draw(){push(),noFill(),strokeWeight(4),stroke(123,123,255),circle(this.start.x,this.start.y,this.r*2),stroke(255,179,3),circle(this.end.x,this.end.y,this.r*2),pop()}collide(t,e){let s,o;e==-1?s=this.start.copy():s=this.end.copy(),this.hasTeleported==-1?o=this.start.copy():o=this.end.copy(),!(t.pos.dist(o)<=this.r+t.r)&&(t.pos=s)}isColliding(t){if(j(t.pos,t.r,this.start,this.r))return this.hasTeleported||(this.hasTeleported=1),1;if(j(t.pos,t.r,this.end,this.r))return this.hasTeleported||(this.hasTeleported=-1),-1;this.hasTeleported=!1}}class b{constructor(t){this.points=t;let e=0,s=0;for(const[o,n]of t)e+=o,s+=n;e/=t.length,s/=t.length,this.render=[];for(const[o,n]of t)this.render.push([o-e,n-s]);this.cx=e,this.cy=s,this.startColor=color(61,137,255),this.toColor=color(0,73,186)}draw(){fill(40,150,255),push(),translate(this.cx,this.cy),scale(1);for(let t=-1;t<4;t++){let e;t==-1?e=color(255,247,128):e=lerpColor(this.startColor,this.toColor,t/4),fill(e),beginShape();for(const[s,o]of this.render)vertex(s,o);endShape(),scale(.9)}pop()}collide(t){t.pos=t.prevPos.copy(),t.vel.setMag(0)}isColliding(t){return M(t.pos,t.r,this.points)}}class A extends x{constructor(t,e,s,o,n,r,a=.01){super(t,e,s,o),this.sx=t,this.sy=e,this.dw=n,this.dh=r,this.t=0,this.speed=a}draw(){super.draw(),this.t+=this.speed,this.x=this.sx+this.dw*cos(this.t),this.y=this.sy+this.dh*sin(this.t),push(),noFill(),strokeWeight(1),stroke(255,0,0),rect(this.sx+this.w/2-this.dw,this.sy+this.h/2-this.dh,2*this.dw,2*this.dh),pop()}}const T={[H]:"Ball",[h]:"Bouncer",[W]:"Hole",[d]:"Ice",[p]:"PolygonWall",[w]:"Sand",[u]:"Slope",[f]:"Teleporter",[x]:"Wall",[b]:"Water",[A]:"MovingPlatform"};class B{constructor(t,e=!0){this.obj=t,this.knot=new g(t.pos.x,t.pos.y,this),e&&main.staticKnots.push(this.knot)}draw(){this.obj.draw(),this.knot.draw()}update(){this.obj.pos=this.knot.pos.copy()}export(){return`new ${T[this.obj.constructor]}(${this.knot})`}}function J(){return[{mainb:[48,45],hole:[297,310],static:[],balls:[],bounds:[[0,0],[200,0],[400,100],[400,400],[200,400],[200,200],[0,200]],text:"Pull back and release",par:2},{mainb:[165,182],hole:[989,82],static:[new x(498,1,226,299),new f(882,172,340,181)],balls:[],bounds:[[0,0],[1200,0],[1200,300],[0,300]],text:"Teleporters teleport you places",par:2},{mainb:[80,80],hole:[509,354],static:[new d(0,225,699,56),new u(378,22,104,184,createVector(0,1))],balls:[],bounds:[[0,0],[700,0],[700,400],[0,400]],text:"Ice breaks when you touch it",par:2},{mainb:[49,48],hole:[66,1069],static:[new u(42,182,124,137,createVector(0,1)),new u(313,437,249,115,createVector(1,0)),new u(738,688,122,228,createVector(0,1)),new u(215,1037,336,128,createVector(-1,0))],balls:[],bounds:[[0,0],[200,0],[200,400],[700,400],[900,600],[900,1e3],[700,1200],[0,1200],[0,1e3],[700,1e3],[700,600],[200,600],[0,400]],par:2},{mainb:[406,43],hole:[406,711],static:[new h(128,197),new h(574,102),new h(345,318),new h(116,541),new h(504,669),new w([[257,127],[406,291],[543,52]]),new w([[344,504],[206,450],[36,495],[69,257],[273,243]]),new w([[742,188],[637,242],[515,212],[491,363],[584,488],[752,352]]),new w([[385,467],[480,440],[537,514],[514,601],[371,668],[418,549]]),new w([[286,556],[170,617],[53,599],[66,724],[263,710]]),new h(433,390),new h(665,171),new h(188,68),new h(745,430),new h(237,522),new h(341,607),new h(658,499),new h(591,581)],balls:[],bounds:[[0,0],[800,0],[800,550],[550,750],[0,750]],par:7},{mainb:[-25,54],hole:[541,698],static:[new p([[373,683],[485,705],[377,749],[327,712],[366,557]]),new u(112,247,181,140,createVector(0,1))],balls:[],bounds:[[-100,0],[300,0],[300,400],[500,600],[700,600],[600,800],[300,800],[300,600],[100,400],[100,200],[-100,200]],par:3},{mainb:[240,108],hole:[396,553],static:[new p([[356,390],[395,471],[430,388],[523,379],[455,317],[467,234],[390,274],[310,235],[330,320],[254,367]]),new h(391,131),new h(208,266),new h(260,503),new h(540,497),new h(565,234)],balls:[],bounds:[[150,0],[500,0],[650,150],[650,600],[150,600]],par:5},{mainb:[70,705],hole:[505,269],static:[new b([[546,250],[543,741],[56,740]])],balls:[],bounds:[[550,200],[550,750],[0,750]],text:"Don't touch the water!",par:2},{mainb:[399,152],hole:[805,150],static:[new d(335,2,28,296),new d(437,4,29,295),new d(487,3,25,297),new d(286,4,28,293),new d(232,0,31,303),new d(182,2,37,299),new d(137,2,31,301),new d(532,3,33,299),new d(579,3,34,296),new d(633,3,34,296)],balls:[],bounds:[[0,0],[750,0],[750,100],[850,100],[850,200],[750,200],[750,300],[0,300]],par:5},{mainb:[61,195],hole:[956,55],static:[new h(235,56),new h(398,186),new h(595,58),new h(783,187)],balls:[],bounds:[[0,0],[1050,0],[1050,250],[0,250]],par:4},{mainb:[26,166],hole:[197,657],static:[new f(720,188,92,177),new f(89,317,728,327),new f(730,473,92,454),new f(89,596,729,601),new p([[35,610],[35,715],[143,716]]),new u(68,9,41,119,createVector(0,1)),new x(2,520,700,42)],balls:[],bounds:[[0,0],[800,0],[800,750],[0,750]],par:2},{mainb:[69,162],hole:[1218,113],static:[],balls:[],bounds:[[50,0],[150,150],[250,0],[350,150],[450,0],[550,150],[650,0],[750,150],[850,0],[950,150],[1050,0],[1150,150],[1250,0],[1250,150],[1150,300],[1050,150],[950,300],[850,150],[750,300],[650,150],[550,300],[450,150],[350,300],[250,150],[150,300],[50,200]],par:6},{mainb:[666,160],hole:[691,757],static:[new h(377,282),new h(446,377),new h(510,471),new h(597,368),new h(516,271),new h(602,565),new h(681,467),new h(834,465),new h(749,559),new h(675,664),new h(741,364),new h(865,360),new h(670,272),new h(808,259),new h(935,245),new u(174,13,897,92,createVector(0,1))],balls:[],bounds:[[1100,0],[100,0],[700,900]],par:4},{mainb:[80,80],hole:[391,63],static:[new w([[243,17],[134,12],[121,59],[149,97],[202,128],[281,84],[311,34]])],balls:[],bounds:[[0,0],[526,-2],[528,168],[3,177]],par:2},{mainb:[58,-847],hole:[594,186],static:[new u(444,-494,323,488,createVector(0,1)),new h(175,-646),new h(423,-846),new h(705,-638),new h(828,-772),new p([[251,-795],[302,-559],[522,-646],[570,-539],[647,-759],[379,-661]]),new b([[268,85],[405,145],[401,50]]),new b([[819,41],[953,35],[856,148]]),new p([[973,-821],[997,-779],[991,-706],[968,-664],[889,-597],[827,-665],[903,-691],[953,-758],[892,-830],[799,-845],[926,-848]])],balls:[],bounds:[[0,0],[400,0],[400,-500],[200,-500],[0,-700],[0,-900],[500,-900],[1100,-900],[1100,-700],[800,-500],[800,0],[1200,0],[600,300]],par:5},{mainb:[95,145],hole:[280,479],static:[new x(4,346,195,48),new f(167,437,99,230),new b([[22,440],[73,429],[101,512],[17,543]]),new h(176,622)],balls:[],bounds:[[0,100],[200,100],[200,400],[400,400],[400,700],[0,700]],par:3},{mainb:[80,80],hole:[1149,666],static:[new w([[1032,198],[981,252],[720,248],[602,264],[529,242],[490,100],[626,150],[989,56]]),new w([[1109,448],[1093,349],[677,476],[733,676]]),new b([[544,485],[53,436],[83,708],[534,679]]),new h(220,108),new d(928,621,164,62),new d(1099,515,120,94),new d(1003,555,92,62),new f(482,363,28,33),new x(620,296,621,31),new x(617,411,28,329),new u(312,16,134,311,createVector(1,0))],balls:[],bounds:[[0,0],[1250,0],[1250,750],[0,750]],par:7},{mainb:[58,60],hole:[441,364],static:[new b([[438,78],[379,-66],[209,-14]]),new h(274,128),new h(284,306),new w([[55,312],[30,518],[204,448],[159,346]]),new h(125,205),new p([[251,171],[251,241],[193,207]])],balls:[],bounds:[[0,0],[400,-100],[600,350],[0,600]],par:3},{mainb:[149,100],hole:[998,102],static:[new p([[63,219],[25,295],[19,378],[99,372],[251,285],[121,274]]),new p([[267,127],[287,239],[253,168],[186,164]]),new p([[167,504],[145,379],[93,475],[158,556],[284,581]]),new u(301,439,547,233,createVector(1,0)),new p([[914,340],[910,386],[958,430],[950,355],[1004,317]]),new p([[1055,266],[1074,368],[1014,407],[1122,382]]),new p([[900,153],[1046,188],[943,202],[932,312]])],balls:[],bounds:[[0,0],[300,0],[300,400],[850,400],[850,0],[1150,0],[1150,450],[850,750],[300,750],[0,450]],par:6}]}class N{constructor(t,e,s,o){this.x=main.mainb.pos.x,this.y=main.mainb.pos.y,this.minx=t-width/4+width/2,this.miny=e-height/4+height/2,this.maxx=s+width/4-width/2,this.maxy=o+height/4-height/2,this.scale=1}draw(){translate(width/2,height/2),scale(this.scale),translate(-this.x,-this.y);const t=createVector(mouseX,mouseY).sub(createVector(width/2,height/2)).div(this.scale).add(createVector(this.x,this.y));window.mousex=t.x,window.mousey=t.y,this.x=constrain(lerp(this.x,main.mainb.pos.x,.1),this.minx,this.maxx),this.y=constrain(lerp(this.y,main.mainb.pos.y,.1),this.miny,this.maxy)}}class I{constructor(t){this.a=0,this.direction=0,this.onDone=t}draw(){fill(255,this.a),rect(0,0,width,height),this.a+=this.direction*5,this.a==300&&(this.onDone(),this.direction=-1),this.a<0&&this.end()}begin(){this.direction=1}end(){this.direction=0,this.a=0}}const D=2;class _{constructor(){this.balls=[],this.staticObjs=[],this.totalStrokes=0,this.holeInOnes=0,this.strokes=0,this.scene="menu"}init(){this.levels=J(),this.level=0,this.transition=new I(()=>{this.scene="game",this.transition=new I(()=>{if(this.strokes==1&&this.holeInOnes++,this.level++,this.level>=this.levels.length){this.scene="end";return}this.generateLevel()})})}generateLevel(){const t=this.levels[this.level];this.strokes=0,this.par=t.par;let e=t.bounds;e||(e=[[0,0],[width,0],[width,height],[0,height]]),this.mainb=new U(...t.mainb),this.hole=new W(...t.hole),this.staticObjs=t.static,this.balls=t.balls,this.levelBounds=e,this.guideText=t.text,this.guideOpacity=255;let s=e[0][0],o=e[0][1],n=e[0][0],r=e[0][1];for(let a=1;a<e.length;a++){let[l,c]=e[a];l<s&&(s=l),c<o&&(o=c),l>n&&(n=l),c>r&&(r=c)}this.camera=new N(s,o,n,r),this.balls.push(this.mainb)}drawMenu(){background(123,255,123),push(),textSize(100),textAlign(CENTER),textStyle(BOLD),fill(255,132,43),strokeWeight(16),stroke(191,0,0),text("ector Golf",width/2,100),strokeWeight(8),stroke(191,150,0),sqrt((mouseX-width/2)**2+(mouseY-height/2)**2)<100?fill(255,240,79):fill(255,217,0),circle(width/2,height/2,200,200),fill(191,150,0),noStroke(),triangle(width/2-30,height/2-30-16,width/2-30,height/2+30+16,width/2+30+16,height/2),pop(),this.transition.draw()}drawEnd(){background(123,255,123),textSize(80),textStyle(NORMAL),textAlign(CENTER),fill(39,58,227),strokeWeight(4),stroke(17,33,171),text("You beat the game!",width/2,100),textSize(30),fill(237,153,57),stroke(189,121,43),text(`Thanks for playing!
Credits: Coder100`,width/2,500),strokeWeight(8),stroke(191,150,0),fill(255,240,79),rect(width/2-300,height/2-100,600,160),fill(201,167,64),textSize(50),textStyle(BOLD),textAlign(LEFT),noStroke(),text("STATS",width/2-300+16,height/2-100+16+40),textSize(25),textStyle(NORMAL),text(`Total strokes: ${this.totalStrokes}
Hole in ones: ${this.holeInOnes}`,width/2-300+16,height/2-100+16+80)}draw(){background(123,255,123),push(),this.camera.draw(),push(),fill(94,230,83),strokeWeight(3),stroke(255),beginShape();for(const[t,e]of this.levelBounds)vertex(t,e);endShape(CLOSE),pop();for(let t=0;t<D;t++)for(let e=0;e<this.balls.length;e++){const s=this.balls[e];s.update(D);for(let o=0;o<this.balls.length;o++){if(e==o)continue;const n=this.balls[o];j(s.pos,s.r,n.pos,n.r)&&s.collide(n)}for(const o of this.staticObjs){const n=o.isColliding(s);n&&o.collide(s,n)}}this.hole.isColliding(this.mainb)&&this.hole.collide(this.mainb,()=>{this.transition.begin()});for(const t of this.staticObjs)t.draw();this.hole.draw();for(const t of this.balls)t.draw();pop(),push(),fill(255),stroke(1),strokeWeight(3),textAlign(CENTER),textSize(30),text(this.guideText,width/2,50),textAlign(LEFT),textSize(20),text(`Stroke: ${this.strokes}
Par: ${this.par}`,10,height-60),pop(),this.transition.draw()}}class S extends g{constructor(t,e,s){super(y(t),y(e),s)}update(){this.prevPos=this.pos.copy(),this.selected&&(this.pos=createVector(y(mousePos.x),y(mousePos.y)),this.parent.update(this,p5.Vector.sub(this.pos,this.prevPos)))}}function y(i){return round(i/50)*50}class Q{constructor(){this.pos=createVector(width/2,height/2),this.scale=1}draw(){translate(width/2,height/2),scale(this.scale),translate(-this.pos.x,-this.pos.y),this.offset?window.mousePos=p5.Vector.sub(this.offset,createVector(mouseX,mouseY)).div(this.scale):window.mousePos=createVector(mouseX,mouseY).sub(createVector(width/2,height/2)).div(this.scale).add(this.pos),this.offset&&(this.pos=mousePos.add(this.initialPos))}drawGrid(){push(),strokeWeight(1);for(let t=y(this.pos.x-width/2/this.scale);t<=y(this.pos.x+width/2/this.scale);t+=25)stroke(255,t%50==0?125:50),line(t,this.pos.y-height/2/this.scale,t,this.pos.y+height/2/this.scale);for(let t=y(this.pos.y-height/2/this.scale);t<=y(this.pos.y+height/2/this.scale);t+=25)stroke(255,t%50==0?125:50),line(this.pos.x-width/2/this.scale,t,this.pos.x+width/2/this.scale,t);pop()}beginMove(){this.initialPos=this.pos.copy(),this.offset=createVector(mouseX,mouseY)}endMove(){this.initialPos=null,this.offset=null}changeScale(t){t>0?this.scale*=.9:this.scale*=1.1}}class Z{constructor(){this.knots=[new S(0,0,this),new S(width,0,this),new S(width,height,this),new S(0,height,this)],main.staticKnots.push(...this.knots)}draw(){push(),fill(94,230,83),strokeWeight(3),stroke(255),beginShape();for(const t of this.knots)vertex(t.pos.x,t.pos.y);endShape(CLOSE),pop();for(const t of this.knots)t.draw()}update(){}convertKnots(){return this.knots.map(t=>[t.pos.x,t.pos.y])}addPoint(t,e){const s=new S(t,e,this),o=this.knots;if(o.length<2)o.push(s);else{let n=1/0,r=0;const a=s.pos;for(let l=0;l<o.length;l++){const c=o[l].pos,m=o[(l+1)%o.length].pos,L=p5.Vector.sub(a,c),k=p5.Vector.sub(m,c),v=k.setMag(L.dot(k)/k.mag()).add(c),V=v.dist(a);v.dist(c)+v.dist(m)>=c.dist(m)+5||V<n&&(r=l+1,n=V)}o.splice(r,0,s)}main.staticKnots.push(s),this.update()}export(){return JSON.stringify(this.convertKnots())}}class tt{constructor(){this.balls=[],this.staticObjs=[],this.hasSelected=!1,this.staticKnots=[]}init(){this.mainb=new B(new U(80,80),!1),this.hole=new B(new W(width-80,height-80),!1),this.balls.push(this.mainb),this.levelBounds=new Z,this.camera=new Q}playMode(){const t=new P(this);window.main=t,t.init(),t.generateLevel()}draw(){this.camera.draw(),background(123,255,123),this.levelBounds.draw(),this.camera.drawGrid();for(const t of this.staticObjs)t.draw();this.hole.draw();for(const t of this.balls)t.draw();this.hasSelected||this.checkKnots()}checkKnots(){if(!this.selectedPolygon){for(let t=this.balls.length-1;t>=0;t--)if(this.balls[t].knot.check()){this.hasSelected=!0;return}if(this.hole.knot.check()){this.hasSelected=!0;return}for(let t=this.staticKnots.length-1;t>=0;t--)if(this.staticKnots[t].check()){this.hasSelected=!0;return}}}}class P extends _{constructor(t){super(),this.editor=t}init(){this.transition=new I(this.reset.bind(this))}reset(){window.main=this.editor;const t=this.editor.mainb.obj;t.vel.setMag(0),t.inHole=!0,this.editor.mainb.update()}generateLevel(){this.mainb=this.editor.mainb.obj,this.mainb.inHole=!1,this.balls.push(this.mainb),this.hole=this.editor.hole.obj,this.hole.ballIn=!1;for(const r of this.editor.staticObjs)this.staticObjs.push(r.obj);const t=this.editor.levelBounds.convertKnots();this.levelBounds=t;let e=t[0][0],s=t[0][1],o=t[0][0],n=t[0][1];for(let r=1;r<t.length;r++){let[a,l]=t[r];a<e&&(e=a),l<s&&(s=l),a>o&&(o=a),l>n&&(n=l)}this.camera=new N(e,s,o,n)}}function $(i,t){const e=document.createElement("div"),s=document.createElement("input");s.value=t;const o=document.createElement("button");return o.innerHTML="&times;",o.addEventListener("click",()=>{for(let n=0;n<main.staticObjs.length;n++){const r=main.staticObjs[n];if(i==r){main.staticObjs.splice(n,1);break}}e.remove()}),e.append(s,o),e}function et(i,t){const e=$(i,t),s=document.createElement("button");return s.textContent="rotate",s.addEventListener("click",()=>{i.obj.force.rotate(PI/2)}),e.append(s),e}function O(i,t){const e=$(i,t),s=document.createElement("button");return s.textContent="edit",s.addEventListener("click",()=>{window.main.selectedPolygon=i}),e.append(s),e}class q extends g{constructor(t,e,s,o){super(t,e,s),this.origin=createVector(t,e),this.axis=o}originUpdate(t){this.pos.add(t)}update(){if(this.prevPos=this.pos.copy(),this.selected){const t=mousePos,e=p5.Vector.sub(t,this.origin),s=p5.Vector.setMag(this.axis,e.dot(this.axis)/this.axis.mag()).add(this.origin);this.pos=s,this.parent.update(this,p5.Vector.sub(this.pos,this.prevPos))}}}class E{constructor(t){this.obj=t,this.knots=[],this.centerKnot=new g(0,0,this),main.staticKnots.push(this.centerKnot)}draw(){this.obj.draw();for(const t of this.knots)t.draw();this.centerKnot.draw()}convertKnots(){return this.knots.map(t=>[t.pos.x,t.pos.y])}update(t,e){if(t==this.centerKnot)for(const s of this.knots)s.pos.add(e);else this.calcCenter();if(this.obj instanceof b){const s=this.centerKnot.pos.x,o=this.centerKnot.pos.y;this.obj.cx=s,this.obj.cy=o;const n=[];for(const r of this.knots)n.push([r.pos.x-s,r.pos.y-o]);this.obj.render=n}this.obj.points=this.convertKnots()}calcCenter(){let t=0,e=0;for(const s of this.knots)t+=s.pos.x,e+=s.pos.y;t/=this.knots.length,e/=this.knots.length,this.centerKnot.pos=createVector(t,e)}addPoint(t,e){const s=new g(t,e,this),o=this.knots;if(o.length<2)o.push(s);else{let n=1/0,r=0;const a=s.pos;for(let l=0;l<o.length;l++){const c=o[l].pos,m=o[(l+1)%o.length].pos,L=p5.Vector.sub(a,c),k=p5.Vector.sub(m,c),v=k.setMag(L.dot(k)/k.mag()).add(c),V=v.dist(a);v.dist(c)+v.dist(m)>=c.dist(m)+5||V<n&&(r=l+1,n=V)}o.splice(r,0,s)}main.staticKnots.push(s),this.update()}export(){const t=[];for(const[e,s]of this.obj.points)t.push([round(e),round(s)]);return`new ${T[this.obj.constructor]}(${JSON.stringify(t)})`}}class K extends E{constructor(t){super(t),this.knots=[new g(this.obj.x,this.obj.y,this),new g(this.obj.x+this.obj.w,this.obj.y+this.obj.h,this)],main.staticKnots.push(...this.knots),this.calcCenter()}update(t,e){super.update(t,e),this.obj.x=this.knots[0].pos.x,this.obj.y=this.knots[0].pos.y,this.obj.w=this.knots[1].pos.x-this.obj.x,this.obj.h=this.knots[1].pos.y-this.obj.y}export(){let t=`new ${T[this.obj.constructor]}(${round(this.obj.x)}, ${round(this.obj.y)}, ${round(this.obj.w)}, ${round(this.obj.h)}`;if(this.obj instanceof u){const e=p5.Vector.normalize(this.obj.force);t+=`, createVector(${round(e.x)}, ${round(e.y)})`}return`${t})`}}class st extends K{constructor(t){super(t),this.deltas=[new q(this.obj.x+this.obj.w,this.obj.y+this.obj.h/2,this,createVector(1,0)),new q(this.obj.x+this.obj.w/2,this.obj.y+this.obj.h,this,createVector(0,1))],main.staticKnots.push(...this.deltas)}update(t,e){if(super.update(t,e),this.deltas.includes(t)){const s=this.deltas[0].pos.x-this.obj.x-this.obj.w/2,o=this.deltas[1].pos.y-this.obj.y-this.obj.h/2;this.obj.dw=s,this.obj.dh=o}else{const s=createVector(this.obj.x+this.obj.w/2+this.obj.dw,this.obj.y+this.obj.h/2),o=createVector(this.obj.x+this.obj.w/2,this.obj.y+this.obj.h/2+this.obj.dh);this.deltas[0].pos=s,this.deltas[0].origin=s,this.deltas[1].pos=o,this.deltas[1].origin=o}}draw(){const t=this.obj;fill(0,0,255),rect(this.obj.x,this.obj.y,this.obj.w,this.obj.h),push(),noFill(),strokeWeight(1),stroke(255,0,0),rect(t.x+t.w/2-t.dw,t.y+t.h/2-t.dh,2*this.obj.dw,2*this.obj.dh),pop();for(const e of this.knots)e.draw();for(const e of this.deltas)e.draw();this.centerKnot.draw()}}class it{constructor(t){this.obj=t,this.startKnot=new g(t.start.x,t.start.y,this),this.endKnot=new g(t.end.x,t.end.y,this),main.staticKnots.push(this.startKnot,this.endKnot)}draw(){this.obj.draw(),this.startKnot.draw(),this.endKnot.draw()}update(){this.obj.start=this.startKnot.pos,this.obj.end=this.endKnot.pos}export(){return`new ${T[this.obj.constructor]}(${this.startKnot}, ${this.endKnot})`}}const ot=[{name:"Square Wall",create:(i,t)=>new K(new x(i,t,30,30))},{name:"Ice",create:(i,t)=>new K(new d(i,t,30,30))},{name:"Bouncer",create:(i,t)=>new B(new h(i,t))},{name:"Slope",create:(i,t)=>new K(new u(i,t,30,30,createVector(1,0))),render:et},{name:"Polygon Wall",create:()=>{const i=new E(new p([]));return main.selectedPolygon=i,i},render:O},{name:"Water",create:()=>{const i=new E(new b([]));return main.selectedPolygon=i,i},render:O},{name:"Sand",create:()=>{const i=new E(new w([]));return main.selectedPolygon=i,i},render:O},{name:"Teleporter",create:(i,t)=>new it(new f(i,t,i,t))},{name:"Moving Platform",create:(i,t)=>new st(new A(i,t,30,30,0,0))}],nt=document.querySelector(".object-template"),ht=document.querySelector(".objects-list");for(const i of ot){const t=document.createElement("button");t.textContent=i.name,t.addEventListener("click",()=>{const e=i.create(main.camera.pos.x,main.camera.pos.y);main.staticObjs.push(e);const o=(i.render||$)(e,i.name);ht.append(o)}),nt.append(t)}window.p5=R;window.mousex=void 0;window.mousey=void 0;window.main=new tt;window.setup=()=>{noStroke();const i=createCanvas(.8*windowWidth,windowHeight).parent(document.querySelector(".canvas-content"));i.mousePressed(rt),i.mouseClicked(at),i.mouseWheel(lt),i.elt.addEventListener("selectstart",t=>t.preventDefault()),i.elt.addEventListener("contextmenu",t=>t.preventDefault()),i.elt.addEventListener("wheel",t=>t.preventDefault()),i.elt.addEventListener("mousedown",t=>{t.button==1&&t.preventDefault()}),main.init()};window.draw=()=>{push(),main.draw(),pop(),main.selectedPolygon&&(fill(0),textAlign(CENTER),textSize(20),text(`Left click to add vertex, Right click to remove vertex
Esc to finish`,width/2,30))};function rt(){if(main instanceof P||(mouseButton==CENTER&&main.camera.beginMove(),!main.selectedPolygon))return;let i=main.selectedPolygon;if(mouseButton==LEFT)i.addPoint(mousePos.x,mousePos.y);else if(mouseButton==RIGHT){for(let t=i.knots.length-1;t>=0;t--)if(i.knots[t].check()){i.knots.splice(t,1),i.update();break}}}function at(){if(main instanceof P){const i=R.Vector.sub(createVector(mousex,mousey),main.mainb.pos).div(32);main.mainb.vel=i}}window.keyPressed=()=>{main.selectedPolygon&&key=="Escape"&&(main.selectedPolygon=null)};window.mouseReleased=()=>{main instanceof P||(main.hasSelected=!1,main.camera.endMove())};function lt(i){main.camera.changeScale(i.deltaY)}document.querySelector(".play-btn").addEventListener("click",()=>{main instanceof P?main.reset():main.playMode()});document.querySelector(".edit-bound-btn").addEventListener("click",()=>{main.selectedPolygon=main.levelBounds});document.querySelector(".export-btn").addEventListener("click",()=>{let i="";for(const e of main.staticObjs)i+=e.export()+`,
`;let t=`{
mainb: [${main.mainb.knot}],
hole: [${main.hole.knot}],
static: [${i}],
balls: [],
bounds: ${main.levelBounds.export()},
}`;document.querySelector(".export-text").value=t});document.querySelector(".copy-export-btn").addEventListener("click",async()=>{const i=document.querySelector(".export-text").value;await navigator.clipboard.writeText(i),document.querySelector(".copy-export-btn").textContent="Copied!",setTimeout(()=>{document.querySelector(".copy-export-btn").textContent="Copy"},1e3)});window.onbeforeunload=()=>"Are you sure you want to leave?";
